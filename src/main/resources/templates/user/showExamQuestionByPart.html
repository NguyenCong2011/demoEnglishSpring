<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TOEIC Test</title>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <style>
            /* Customize Timer */
            #timer {
                position: fixed;
                top: 50px;
                right: 20px;
                background-color: #007bff;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                font-size: 20px;
                z-index: 1000;
            }
        </style>
    </head>

<body class="bg-gray-100">

<!-- Header -->
<div th:replace="~{header.html}"></div>

<!-- Đồng hồ đếm ngược -->
<div id="timer">120:00</div>

<!-- Nội dung bài thi -->
<div class="max-w-7xl mx-auto p-6">

    <!-- Phần chọn đề -->
    <div class="flex justify-center gap-4 mb-8">
        <button onclick="filterPart(1)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 1</button>
        <button onclick="filterPart(2)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 2</button>
        <button onclick="filterPart(3)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 3</button>
        <button onclick="filterPart(4)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 4</button>
        <button onclick="filterPart(5)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 5</button>
        <button onclick="filterPart(6)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 6</button>
        <button onclick="filterPart(7)" class="px-6 py-3 bg-gray-200 hover:bg-blue-600 text-gray-800 hover:text-white rounded-lg transition duration-300 transform hover:scale-105">Part 7</button>
    </div>

    <!-- Phần Audio nếu có -->
    <div th:if="${toeicExam.audio != null and !toeicExam.audio.isEmpty()}" class="mb-8">
        <audio controls class="w-full max-w-xl mx-auto">
            <source th:src="@{'/audio/' + ${toeicExam.audio}}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </div>

    <form method="post" th:action="@{/user/submit-toeic-exam}" class="bg-white p-8 rounded-lg shadow-lg">
        <input type="hidden" name="examId" th:value="${examId}" />

        <div class="space-y-6">
            <div th:each="question, iter : ${toeicQuestions}" th:attr="data-part=${question.part}">
                <div class="border p-4 rounded-lg shadow-sm bg-gray-50">
                    <input type="hidden" name="questionIds" th:value="${question.questionId}" />

                    <!-- Question Image -->
                    <div th:if="${question.image != null}" class="mb-4">
                        <img th:src="@{${question.image}}" alt="Question Image" class="max-w-full h-auto rounded-lg shadow-md" />
                    </div>

                    <p class="font-semibold text-lg mb-4">
                        <span th:text="'Question ' + (${iter.index + 1}) + ' (Part ' + ${question.part} + ')'"></span>:
                        <span th:text="${question.questionText}"></span>
                    </p>

                    <!-- Answer Options -->
                    <div class="space-y-4">
                        <label class="flex items-center space-x-2">
                            <input type="radio" th:name="'answers[' + ${question.questionId} + ']'" th:value="'Answer 1'" class="text-blue-600" />
                            <span th:text="${question.dapAn1}"></span>
                        </label>

                        <label class="flex items-center space-x-2">
                            <input type="radio" th:name="'answers[' + ${question.questionId} + ']'" th:value="'Answer 2'" class="text-blue-600" />
                            <span th:text="${question.dapAn2}"></span>
                        </label>

                        <label class="flex items-center space-x-2">
                            <input type="radio" th:name="'answers[' + ${question.questionId} + ']'" th:value="'Answer 3'" class="text-blue-600" />
                            <span th:text="${question.dapAn3}"></span>
                        </label>

                        <!-- Only show Answer 4 if not Part 2 -->
                        <label th:if="${question.part != 2}" class="flex items-center space-x-2">
                            <input type="radio" th:name="'answers[' + ${question.questionId} + ']'" th:value="'Answer 4'" class="text-blue-600" />
                            <span th:text="${question.dapAn4}"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center mt-8">
            <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300">Nộp bài</button>
        </div>
    </form>
</div>

</body>

<!-- Script -->
<script>
    function filterPart(part) {
        const items = document.querySelectorAll('.question-item');
        items.forEach(item => {
            const itemPart = item.getAttribute('data-part');
            if (part === 'all' || itemPart === String(part)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });

        document.querySelectorAll('.part-links button').forEach(btn => {
            btn.classList.remove('active');
        });
        if (part === 'all') {
            document.querySelector('.part-links button:last-child').classList.add('active');
        } else {
            document.querySelectorAll('.part-links button')[part - 1].classList.add('active');
        }
    }

    function startTimer(duration, display) {
        let timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                // Hết giờ thì submit bài
                alert("Hết giờ! Bài thi sẽ được nộp tự động.");
                document.querySelector('form').submit();
            }
        }, 1000);
    }

    // Khi trang load xong
    window.onload = function () {
        filterPart(1); // Load tất cả câu hỏi ban đầu

        const timeLimit = 120 * 60; // 120 phút -> giây
        const display = document.getElementById('timer');
        startTimer(timeLimit, display);
    };
</script>

<!-- Footer -->
<div th:replace="~{footer.html}"></div>

</body>
</html>
